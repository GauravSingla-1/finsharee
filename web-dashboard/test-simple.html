<!DOCTYPE html>
<html>
<head>
    <title>FinShare Simple Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        button { padding: 10px 15px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        .result { margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 3px; font-family: monospace; white-space: pre-wrap; }
        .token-display { background: #fff3cd; padding: 10px; border-radius: 3px; margin: 10px 0; word-break: break-all; }
        input { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>FinShare API Simple Test</h1>
    
    <div class="test-section">
        <h3>Step 1: Get JWT Token</h3>
        <button onclick="getToken()">Login & Get Token</button>
        <div id="token-result" class="result"></div>
        <div id="token-display" class="token-display" style="display: none;"></div>
    </div>

    <div class="test-section">
        <h3>Step 2: Test Authenticated Endpoints</h3>
        <button onclick="testUserInfo()">Get User Info</button>
        <button onclick="testGroups()">Get Groups</button>
        <button onclick="testExpenses()">Get Expenses</button>
        <button onclick="testAI()">Test AI Categorization</button>
        <div id="api-result" class="result"></div>
    </div>

    <div class="test-section">
        <h3>Step 3: Create Test Data</h3>
        <button onclick="createGroup()">Create Test Group</button>
        <button onclick="createExpense()">Create Test Expense</button>
        <div id="create-result" class="result"></div>
    </div>

    <script>
        let authToken = '';

        async function getToken() {
            const resultDiv = document.getElementById('token-result');
            const tokenDiv = document.getElementById('token-display');
            
            resultDiv.textContent = 'Getting token...';
            
            try {
                const response = await fetch('http://127.0.0.1:5000/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: 'demo@finshare.app',
                        password: 'password123'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok && data.token) {
                    authToken = data.token;
                    resultDiv.textContent = `✅ Login successful!\nUser: ${data.user.name}\nEmail: ${data.user.email}`;
                    tokenDiv.textContent = `JWT Token: ${authToken}`;
                    tokenDiv.style.display = 'block';
                } else {
                    resultDiv.textContent = `❌ Login failed: ${JSON.stringify(data)}`;
                }
            } catch (error) {
                resultDiv.textContent = `❌ Error: ${error.message}`;
            }
        }

        async function testUserInfo() {
            const resultDiv = document.getElementById('api-result');
            
            if (!authToken) {
                resultDiv.textContent = '❌ Please get a token first';
                return;
            }
            
            resultDiv.textContent = 'Testing user info...';
            
            try {
                const response = await fetch('http://127.0.0.1:5000/api/auth/user', {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                const data = await response.json();
                resultDiv.textContent = `User Info (${response.status}):\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                resultDiv.textContent = `❌ Error: ${error.message}`;
            }
        }

        async function testGroups() {
            const resultDiv = document.getElementById('api-result');
            
            if (!authToken) {
                resultDiv.textContent = '❌ Please get a token first';
                return;
            }
            
            resultDiv.textContent = 'Testing groups...';
            
            try {
                const response = await fetch('http://127.0.0.1:5000/api/groups', {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                const data = await response.json();
                resultDiv.textContent = `Groups (${response.status}):\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                resultDiv.textContent = `❌ Error: ${error.message}`;
            }
        }

        async function testExpenses() {
            const resultDiv = document.getElementById('api-result');
            
            if (!authToken) {
                resultDiv.textContent = '❌ Please get a token first';
                return;
            }
            
            resultDiv.textContent = 'Testing expenses...';
            
            try {
                const response = await fetch('http://127.0.0.1:5000/api/expenses', {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                const data = await response.json();
                resultDiv.textContent = `Expenses (${response.status}):\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                resultDiv.textContent = `❌ Error: ${error.message}`;
            }
        }

        async function testAI() {
            const resultDiv = document.getElementById('api-result');
            
            resultDiv.textContent = 'Testing AI categorization...';
            
            try {
                const response = await fetch('http://127.0.0.1:5000/api/ai/categorize', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken || 'no-token'}`
                    },
                    body: JSON.stringify({
                        description: 'Coffee at Starbucks',
                        amount: 5.50
                    })
                });
                
                const data = await response.json();
                resultDiv.textContent = `AI Categorization (${response.status}):\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                resultDiv.textContent = `❌ Error: ${error.message}`;
            }
        }

        async function createGroup() {
            const resultDiv = document.getElementById('create-result');
            
            if (!authToken) {
                resultDiv.textContent = '❌ Please get a token first';
                return;
            }
            
            resultDiv.textContent = 'Creating test group...';
            
            try {
                const response = await fetch('http://127.0.0.1:5000/api/groups', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        name: 'Test Group ' + Date.now(),
                        members: ['user1', 'user2']
                    })
                });
                
                const data = await response.json();
                resultDiv.textContent = `Create Group (${response.status}):\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                resultDiv.textContent = `❌ Error: ${error.message}`;
            }
        }

        async function createExpense() {
            const resultDiv = document.getElementById('create-result');
            
            if (!authToken) {
                resultDiv.textContent = '❌ Please get a token first';
                return;
            }
            
            resultDiv.textContent = 'Creating test expense...';
            
            try {
                const response = await fetch('http://127.0.0.1:5000/api/expenses', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        description: 'Test Coffee',
                        amount: 5.50,
                        groupId: 'test-group',
                        category: 'Food'
                    })
                });
                
                const data = await response.json();
                resultDiv.textContent = `Create Expense (${response.status}):\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                resultDiv.textContent = `❌ Error: ${error.message}`;
            }
        }
    </script>
</body>
</html>