<!DOCTYPE html>
<html>
<head>
    <title>FinShare Working Test Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .panel { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        button { background: #007bff; color: white; border: none; padding: 10px 15px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        .result { background: #f8f9fa; padding: 15px; border-radius: 4px; margin-top: 10px; font-family: monospace; white-space: pre-wrap; max-height: 300px; overflow-y: auto; }
        .token { background: #fff3cd; padding: 10px; border-radius: 4px; margin: 10px 0; word-break: break-all; border: 1px solid #ffeaa7; }
        .status { display: flex; align-items: center; margin: 5px 0; }
        .status.online { color: #28a745; }
        .status.offline { color: #dc3545; }
        input { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px; }
        .services-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-top: 15px; }
        .service-card { padding: 10px; border: 1px solid #ddd; border-radius: 4px; text-align: center; }
        .service-card.online { background: #d4edda; border-color: #c3e6cb; }
        .service-card.offline { background: #f8d7da; border-color: #f5c6cb; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>FinShare API Test Dashboard</h1>
            <p>Complete testing interface for all FinShare microservices</p>
        </div>

        <div class="grid">
            <div class="panel">
                <h3>Authentication & Token</h3>
                <button onclick="getAuthToken()">Get JWT Token</button>
                <button onclick="testUserInfo()">Test User Info</button>
                <div id="token-display" class="token" style="display: none;"></div>
                <div id="auth-result" class="result"></div>
            </div>

            <div class="panel">
                <h3>Service Status</h3>
                <button onclick="checkAllServices()">Check All Services</button>
                <div id="services-status" class="services-grid"></div>
            </div>
        </div>

        <div class="grid">
            <div class="panel">
                <h3>Groups & Expenses</h3>
                <button onclick="testGroups()">Get Groups</button>
                <button onclick="createTestGroup()">Create Test Group</button>
                <button onclick="testExpenses()">Get Expenses</button>
                <button onclick="createTestExpense()">Create Test Expense</button>
                <div id="groups-result" class="result"></div>
            </div>

            <div class="panel">
                <h3>AI & Analytics</h3>
                <button onclick="testAICategorization()">Test AI Categorization</button>
                <button onclick="testAIChat()">Test AI Chat</button>
                <button onclick="testAnalytics()">Test Analytics</button>
                <button onclick="testNotifications()">Test Notifications</button>
                <div id="ai-result" class="result"></div>
            </div>
        </div>

        <div class="panel">
            <h3>Custom API Test</h3>
            <input type="text" id="custom-url" placeholder="Enter API URL (e.g., http://127.0.0.1:5000/api/auth/user)" value="http://127.0.0.1:5000/api/auth/user">
            <select id="custom-method">
                <option value="GET">GET</option>
                <option value="POST">POST</option>
                <option value="PUT">PUT</option>
                <option value="DELETE">DELETE</option>
            </select>
            <textarea id="custom-body" placeholder="Request body (JSON)" style="width: 100%; height: 80px; margin: 5px 0;"></textarea>
            <button onclick="testCustomEndpoint()">Send Request</button>
            <div id="custom-result" class="result"></div>
        </div>
    </div>

    <script>
        let authToken = '';

        async function getAuthToken() {
            const resultDiv = document.getElementById('auth-result');
            const tokenDiv = document.getElementById('token-display');
            
            resultDiv.textContent = 'Getting JWT token...';
            
            try {
                const response = await fetch('http://127.0.0.1:5000/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: 'demo@finshare.app',
                        password: 'password123'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok && data.token) {
                    authToken = data.token;
                    resultDiv.textContent = `✅ Authentication successful!\nUser: ${data.user.name}\nEmail: ${data.user.email}`;
                    tokenDiv.innerHTML = `<strong>JWT Token:</strong><br>${authToken}`;
                    tokenDiv.style.display = 'block';
                } else {
                    resultDiv.textContent = `❌ Authentication failed:\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultDiv.textContent = `❌ Connection error: ${error.message}`;
            }
        }

        async function checkAllServices() {
            const statusDiv = document.getElementById('services-status');
            statusDiv.innerHTML = '';
            
            const services = [
                { name: 'Auth Backend', url: 'http://127.0.0.1:5000/test', port: '5000' },
                { name: 'AI Service', url: 'http://127.0.0.1:8004/', port: '8004' },
                { name: 'Group Service', url: 'http://127.0.0.1:8002/actuator/health', port: '8002' },
                { name: 'Balance Service', url: 'http://127.0.0.1:8003/actuator/health', port: '8003' },
                { name: 'Analytics Service', url: 'http://127.0.0.1:8005/actuator/health', port: '8005' },
                { name: 'Notification Service', url: 'http://127.0.0.1:8006/actuator/health', port: '8006' }
            ];

            for (const service of services) {
                const card = document.createElement('div');
                card.className = 'service-card';
                card.innerHTML = `<strong>${service.name}</strong><br>Port ${service.port}<br><span id="status-${service.port}">Checking...</span>`;
                statusDiv.appendChild(card);

                try {
                    const response = await fetch(service.url);
                    const statusEl = document.getElementById(`status-${service.port}`);
                    
                    if (response.ok) {
                        card.className = 'service-card online';
                        statusEl.textContent = '✅ Online';
                    } else {
                        card.className = 'service-card offline';
                        statusEl.textContent = '❌ Error';
                    }
                } catch (error) {
                    card.className = 'service-card offline';
                    const statusEl = document.getElementById(`status-${service.port}`);
                    statusEl.textContent = '❌ Offline';
                }
            }
        }

        async function testUserInfo() {
            const resultDiv = document.getElementById('auth-result');
            
            if (!authToken) {
                resultDiv.textContent = '❌ Please get an authentication token first';
                return;
            }
            
            try {
                const response = await fetch('http://127.0.0.1:5000/api/auth/user', {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                const data = await response.json();
                resultDiv.textContent = `User Info Response (${response.status}):\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                resultDiv.textContent = `❌ Error: ${error.message}`;
            }
        }

        async function testGroups() {
            const resultDiv = document.getElementById('groups-result');
            
            try {
                const response = await fetch('http://127.0.0.1:5000/api/groups', {
                    headers: authToken ? { 'Authorization': `Bearer ${authToken}` } : {}
                });
                
                const data = await response.json();
                resultDiv.textContent = `Groups Response (${response.status}):\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                resultDiv.textContent = `❌ Error: ${error.message}`;
            }
        }

        async function createTestGroup() {
            const resultDiv = document.getElementById('groups-result');
            
            if (!authToken) {
                resultDiv.textContent = '❌ Please get an authentication token first';
                return;
            }
            
            try {
                const response = await fetch('http://127.0.0.1:5000/api/groups', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        name: `Test Group ${Date.now()}`,
                        members: ['user1']
                    })
                });
                
                const data = await response.json();
                resultDiv.textContent = `Create Group Response (${response.status}):\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                resultDiv.textContent = `❌ Error: ${error.message}`;
            }
        }

        async function testExpenses() {
            const resultDiv = document.getElementById('groups-result');
            
            try {
                const response = await fetch('http://127.0.0.1:5000/api/expenses', {
                    headers: authToken ? { 'Authorization': `Bearer ${authToken}` } : {}
                });
                
                const data = await response.json();
                resultDiv.textContent = `Expenses Response (${response.status}):\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                resultDiv.textContent = `❌ Error: ${error.message}`;
            }
        }

        async function createTestExpense() {
            const resultDiv = document.getElementById('groups-result');
            
            if (!authToken) {
                resultDiv.textContent = '❌ Please get an authentication token first';
                return;
            }
            
            try {
                const response = await fetch('http://127.0.0.1:5000/api/expenses', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        description: `Test Expense ${Date.now()}`,
                        amount: 25.50,
                        groupId: 'test-group',
                        category: 'Food'
                    })
                });
                
                const data = await response.json();
                resultDiv.textContent = `Create Expense Response (${response.status}):\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                resultDiv.textContent = `❌ Error: ${error.message}`;
            }
        }

        async function testAICategorization() {
            const resultDiv = document.getElementById('ai-result');
            
            try {
                const response = await fetch('http://127.0.0.1:5000/api/ai/categorize', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken || 'test'}`
                    },
                    body: JSON.stringify({
                        description: 'Coffee at Starbucks downtown',
                        amount: 6.75
                    })
                });
                
                const data = await response.json();
                resultDiv.textContent = `AI Categorization Response (${response.status}):\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                resultDiv.textContent = `❌ Error: ${error.message}`;
            }
        }

        async function testAIChat() {
            const resultDiv = document.getElementById('ai-result');
            
            try {
                const response = await fetch('http://127.0.0.1:5000/api/ai/chat', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken || 'test'}`
                    },
                    body: JSON.stringify({
                        message: 'What are some good budgeting tips?'
                    })
                });
                
                const data = await response.json();
                resultDiv.textContent = `AI Chat Response (${response.status}):\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                resultDiv.textContent = `❌ Error: ${error.message}`;
            }
        }

        async function testAnalytics() {
            const resultDiv = document.getElementById('ai-result');
            
            try {
                const response = await fetch('http://127.0.0.1:5000/api/dashboard', {
                    headers: authToken ? { 'Authorization': `Bearer ${authToken}` } : {}
                });
                
                const data = await response.json();
                resultDiv.textContent = `Dashboard Analytics Response (${response.status}):\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                resultDiv.textContent = `❌ Error: ${error.message}`;
            }
        }

        async function testNotifications() {
            const resultDiv = document.getElementById('ai-result');
            
            try {
                const response = await fetch('http://127.0.0.1:5000/api/notifications', {
                    headers: authToken ? { 'Authorization': `Bearer ${authToken}` } : {}
                });
                
                const data = await response.json();
                resultDiv.textContent = `Notifications Response (${response.status}):\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                resultDiv.textContent = `❌ Error: ${error.message}`;
            }
        }

        async function testCustomEndpoint() {
            const resultDiv = document.getElementById('custom-result');
            const url = document.getElementById('custom-url').value;
            const method = document.getElementById('custom-method').value;
            const body = document.getElementById('custom-body').value;
            
            if (!url) {
                resultDiv.textContent = '❌ Please enter a URL';
                return;
            }
            
            try {
                const options = {
                    method: method,
                    headers: {}
                };
                
                if (authToken) {
                    options.headers['Authorization'] = `Bearer ${authToken}`;
                }
                
                if (body && (method === 'POST' || method === 'PUT')) {
                    options.headers['Content-Type'] = 'application/json';
                    options.body = body;
                }
                
                const response = await fetch(url, options);
                const data = await response.text();
                
                resultDiv.textContent = `Custom Request Response (${response.status}):\n${data}`;
            } catch (error) {
                resultDiv.textContent = `❌ Error: ${error.message}`;
            }
        }

        // Auto-check services on load
        window.onload = function() {
            checkAllServices();
        };
    </script>
</body>
</html>